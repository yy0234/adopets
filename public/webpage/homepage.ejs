
<link rel="stylesheet" type="text/css" href="/stylesheets/pages/index.css" />
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap-multiselect.css"/>
<link rel="stylesheet" type="text/css" href="/stylesheets/nouislider.min.css"/>
<link rel="stylesheet" type="text/css" href="/stylesheets/fontawesome-all.css"/>
<link href="https://fonts.googleapis.com/css?family=Macondo|Philosopher|Amaranth" rel="stylesheet">

<section class="headline"><!-- Begin Headline -->
    <div class="row header container-fluid">
        <div class="col-md-8">
            <div class="banner-text">Adopets Web<br/><span class="banner-small-text">A comprehensive Pet Adoption Management System</span></div>
        </div>
        <div class="col-md-3" style="text-align: center;">
            <img style="margin-bottom: 15px;" src="/images/banner.svg" alt="banner" />
        </div>
    </div>
</section><!-- End Headline -->

<div class="container-fluid">
	<div class="row" style="margin-left:10px;margin-right:10px;">
		<!--search Box-->
		<div class="col-md-5">
			<div class="searchBox">
				<ul class="nav nav-tabs" id="searchTab" role="tablist">
					<li class="nav-item active">
						<a class="nav-link active" data-toggle="tab" href="#direct" role="tab" aria-controls="direct">Direct Search</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" data-toggle="tab" href="#basic" role="tab" aria-controls="basic">Basic Search</a>
					</li>
				</ul>
					
				<div class="tab-content">
					<div class="tab-pane active" id="direct" role="tabpanel">
							<div class="input-group">
								<input type="text" id="auto_complete" class="form-control" placeholder="What pets are you looking for?"/>
								<span class="input-group-addon">
									<input id="inputFile" type="file" accept=".png, .jpg, .jpeg" onchange="encodeImageFileAsURL();" style="display:none"/><i class="fas fa-camera" title="Search by photo" style="cursor:pointer;" onclick="fileUpload()"></i>
									<i class="fas fa-search" style="cursor:pointer;" onclick="changeASQByKey();dynamic('/toPetSearch');"></i>
								</span>
							</div>
							<div class="directButton">
								<div style="display:table">
									<div style="display:table-row">
										<div style="display:table-cell">
											<button type="button" class="btn btn-secondary" onclick="dynamic('/toPetSearch');changeASQ(' AND type=\'bird\'');changeList('bird');";>Birds</button>
										</div>
										<div style="display:table-cell">
											<button type="button" class="btn btn-primary" onclick="dynamic('/toPetSearch');changeASQ(' AND type=\'cat\'');changeList('cat');">Cat</button>
										</div>
										<div style="display:table-cell">
											<button type="button" class="btn btn-success" onclick="dynamic('/toPetSearch');changeASQ(' AND type=\'dog\'');changeList('dog');">Dog</button>
										</div>
									</div>
									<div style="display:table-row">
										<div style="display:table-cell">
											<button type="button" class="btn btn-info" onclick="dynamic('/toPetSearch');changeASQ(' AND type=\'fish\'');changeList('fish');">Fish</button>
										</div>
										<div style="display:table-cell">
											<button type="button" style="color:white; background-color: #ffa500;" class="btn btn-warning" onclick="dynamic('/toPetSearch');changeASQ(' AND type=\'reptile\'');changeList('reptile');">Reptiles</button>
										</div>
										<div style="display:table-cell">
											<button type="button" class="btn btn-danger" onclick="dynamic('/toPetSearch');changeASQ(' AND type=\'rodent\'');changeList('rodent');">Rodents</button>
										</div>
									</div>
								</div>
							</div>
					</div>
					<div class="tab-pane" id="basic" role="tabpanel">
						<div class="row">
							<div class="col-md-6">
								<select id="petTypes" multiple="multiple">
									<option value="bird">Birds</option>
									<option value="cat">Cat</option>
									<option value="dog">Dog</option>
									<option value="fish">Fish</option>
									<option value="reptile">Reptiles</option>
									<option value="rodent">Rodents</option>
								</select>
							</div>
							<div class="col-md-6">
								<select id="petBreeds" multiple="multiple">
								</select>
							</div>
						</div>
						<div class="row">
							<div class="col-md-4">
								<select id="petGender" multiple="multiple">
									<option value="male">Male</option>
									<option value="female">Female</option>
									<option value="bisexual">Bisexual</option>
								</select>
							</div>
							<div class="col-md-4">
								
								<!--<select id="petAge" multiple="multiple">
									<option value="baby">Baby</option>
									<option value="young">Young</option>
									<option value="adult">Adult</option>
									<option value="senior">Senior</option>
								</select>-->
								<div class="dropdown">
									<button id="petAgeTextHolder" class="btn btn-default dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="width:100%;color:#555">Age<span class="caret"></span></button>
									<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
										<div class="ageRange" style="text-align: center;">
											<div id="petAge" style="margin-left: 20px;margin-right: 20px;margin-top: 10px;margin-bottom: 10px;"></div>
											<div style="font-size: 14px;">From <span id='lower-value'></span> to <span id='upper-value'></span> years-old</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-md-4">
								<select id="petSize" multiple="multiple">
									<option value="small">Small</option>
									<option value="medium">Medium</option>
									<option value="large">Large</option>
									<option value="x-large">X-Large</option>
								</select>
							</div>
						</div>
						<div class="row">
							<button type="button" class="btn btn-info" onclick="changeASQBySelect()">Find Pets</button>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="col-md-7" style="margin-top: 30px; text-align:center;">
			<div class="missionSection">
				<div>
					<h4 style="font-family: 'Amaranth', sans-serif;"> -  Our Mission  - </h4>
					<div>
						<div style="padding:25px; padding-top:10px;">Adopet Web aims to provide pet adoption service
								with comprehensive features that is convenient for all the
								individuals that intend to adopt pets. It's include:</div>

						<div class="row" style="justify-content: center;">
							<div class="col-md-2" style="padding-top: 10px;"><i class="fab fa-searchengin" style="font-size:55px;"></i><p style="font-size:15px;color: gray;font-family: 'Amaranth', sans-serif;padding-top: 10px;">Adoption</p></div>
							<div class="col-md-2" style="padding-top: 10px;"><i class="fas fa-shopping-cart" style="font-size:55px;"></i><p style="font-size:15px;color: gray;font-family: 'Amaranth', sans-serif;padding-top: 10px;">Transaction</p></div>
							<div class="col-md-2" style="padding-top: 10px;"><i class="fas fa-comments" style="font-size:55px;"></i><p style="font-size:15px;color: gray;font-family: 'Amaranth', sans-serif;padding-top: 10px;">Forum</p></div>
							<div class="col-md-2" style="padding-top: 10px;"><i class="fas fa-language" style="font-size:55px;"></i><p style="font-size:15px;color: gray;font-family: 'Amaranth', sans-serif;padding-top: 10px;">Message</p></div>
						</div>	
					
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--flexslider-->
	<div class="suggestion" style="margin-top: 30px;">
		<div class="innerBox" style="padding: 30px;">
			<div class="lineOnSlide">You May Also Interested</div>
			<div class="flexslider carousel" style="overflow:hidden">
				<ul class="slides">
					
				</ul>
			</div>
			<div style="float:right;"><a onclick="dynamic('/toPetSearch')" style="cursor:pointer;color:blue">more >></a></div>
		</div>
	</div>

	<!--pet detail-->
	<div class="modal fade" id="petDetailModal" tabindex="-1" role="dialog" aria-labelledby="petDetailModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header" style="border-bottom:none;">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body" style="margin-bottom: 20px;">
					<div class="row" style="margin-left:0;margin-right:0;">
						<div class="col-md-5 col-lg-4" style="text-align:center;margin-top:10px;margin-bottom:10px;">
							<a id="modal_petImage"><img src="/images/cat3.jpg" /></a>
							<div class="row" style="margin-left:0;margin-right:0;margin-top:40px">
								<div class="col-md-12" style="margin-bottom:20px;">
									<button type="button" class="btn btn-danger" style="width:80%"><i class="far fa-heart" style="color:white; margin-right:5px;"></i>Add to Favorites</button>
								</div>
								<div class="col-md-12">
									<button type="button" class="btn btn-primary" style="width:80%">Contact Provider</button>
								</div>
							</div>
						</div>
						<div class="col-md-7 col-lg-8" id="scrollbar" style="margin-bottom:10px; max-height: 500px; overflow-y: auto;">
							<div class="row" style="margin-left:0;margin-right:0;border-bottom: 1px solid lightgray;padding-bottom: 20px;">
								<div class="col-md-12 col-lg-6">
									<div style="display:table;width:100%;line-height: 30px; margin-top: 10px;">
										<div style="display:table-row;">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Pet ID
											</div>
											<div id="modal_petId" style="display:table-cell">
												001
											</div>
										</div>
										<div style="display:table-row;">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Name
											</div>
											<div id="modal_petName" style="display:table-cell">
												Name
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Age
											</div>
											<div id="modal_petAge" style="display:table-cell">
												Age
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Size
											</div>
											<div id="modal_petSize" style="display:table-cell">
												Small
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Coat length
											</div>
											<div id="modal_petCoat" style="display:table-cell">
												Medium
											</div>
										</div>
									</div>
								</div>
								<div class="col-md-12 col-lg-6">
									<div style="display:table; width:100%; line-height: 30px; margin-top: 10px;">
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Post date
											</div>
											<div id="modal_petPostDate" style="display:table-cell">
												2018/2/21
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Gender
											</div>
											<div id="modal_petGender" style="display:table-cell">
												Male
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Breed type
											</div>
											<div id="modal_petBreed" style="display:table-cell">
												Mixed
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Neutered
											</div>
											<div id="modal_petNeutered" style="display:table-cell">
												Yes
											</div>
										</div>
										<div style="display:table-row">
											<div style="display:table-cell; font-weight:bold;width:40%">
												Provider
											</div>
											<div id="modal_petProvider" style="display:table-cell">
												yy0234
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="row" style="margin-left:0;margin-right:0;margin-top: 20px;border-bottom: 1px solid lightgray;padding-bottom: 20px;">
								<div class="col-md-12" style="font-weight:bold;color:blue">
									Description
								</div>
								<div id="modal_petDescription" class="col-md-12 modelpetDescription" style="line-height: 30px;white-space: pre-line;">
									Hi there, I’m Arthur! I’m a soft big short-haired black and white buddy cat.  Tragically my person died in a car accident and I was left in an empty house being fed by the realtor for some months. I’m so happy to be safe here at the shelter but I really want a home of my own with people to love me again.
									
									I’m a little on the shy side and like to hide under blankets until I feel safe. If you approach me though I love petting and I really enjoy being held as well. I like the company of other friendly cats and may be a good buddy to a gentle cat looking for a partner.
									
									My estimated birthdate is 10/1/2015.
								</div>
							</div>
							<div class="row" style="margin-left:0;margin-right:0;margin-top: 20px;padding-bottom: 20px;">
								<div class="col-md-12" style="font-weight:bold;color:grey">
									Remark
								</div>
								<div id="modal_petRemark" class="col-md-12 modelpetDescription" style="line-height: 30px;white-space: pre-line;">
									None
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script src="/javascript/bootstrap-multiselect.js"></script>
<script src="/javascript/nouislider.min.js"></script>
<script src="/javascript/adoption.js"></script>
<script>
	var petData;
	$(window).bind("resize", function(){
    	$('.flexslider').flexslider(0);
	});

	$('#petTypes').change(function(){
		$('#petBreeds').empty();
		if ($(this).val()){
				for (var i=0; i<$(this).val().length;i++){
					switch($(this).val()[i]){
						case "bird":$('#petBreeds').append(bird);break;
						case "cat":$('#petBreeds').append(cat);break;
						case "dog":$('#petBreeds').append(dog);break;
						case "fish":$('#petBreeds').append(fish);break;
						case "reptile":$('#petBreeds').append(reptile);break;
						case "rodent":$('#petBreeds').append(rodent);break;
					}
				}
		}
		$('#petBreeds').multiselect('rebuild');
	});

	function changeModal(elementNo){
		var petData_element=petData[elementNo];
		$("#modal_petImage").html(petData_element.peturl);
		$("#modal_petId").html(petData_element.petid);
		$("#modal_petName").html(petData_element.name);
		$("#modal_petAge").html(petData_element.age);
		$("#modal_petSize").html(petData_element.size);
		$("#modal_petCoat").html(petData_element.coat);
		var d=new Date(petData_element.postdate);
		$("#modal_petPostDate").html(d.getDate()+"-"+(parseInt(d.getMonth())+1)+"-"+d.getFullYear());
		$("#modal_petGender").html(petData_element.gender);
		$("#modal_petBreed").html(petData_element.breed);
		if (petData_element.neutered==true)
			$("#modal_petNeutered").html("Yes");
		else $("#modal_petNeutered").html("No");
		$("#modal_petProvider").html(petData_element.providerid);
		$("#modal_petDescription").html(petData_element.description);
		$("#modal_petRemark").html(petData_element.remark);

	}

    $(document).ready(function() {

		$('#searchTab a:first').tab('show');
        $('#petTypes').multiselect({
			buttonWidth: '100%',
			dropRight: true,
			maxHeight: 150,
			nonSelectedText: 'Pet Types',
			includeSelectAllOption: true,
            selectAllValue: 'select-all-value',
			allSelectedText: 'All Pet Types',
			nSelectedText: ' Pet Types selected'
		});
		$('#petBreeds').multiselect({
			buttonWidth: '100%',
			dropRight: true,
			maxHeight: 200,
			nonSelectedText: 'Breeds',
			includeSelectAllOption: false,
            selectAllValue: 'select-all-value',
			allSelectedText: 'All Breeds',
			nSelectedText: ' Breeds selected',
			enableClickableOptGroups:true,
			disableIfEmpty: true
		});
		$('#petGender').multiselect({
			buttonWidth: '100%',
			dropRight: true,
			maxHeight: 150,
			nonSelectedText: 'Gender',
			includeSelectAllOption: true,
            selectAllValue: 'select-all-value',
			allSelectedText: 'Both'
		});
		/*$('#petAge').multiselect({
			buttonWidth: '100%',
			dropRight: true,
			maxHeight: 150,
			nonSelectedText: 'Age',
			includeSelectAllOption: true,
            selectAllValue: 'select-all-value',
			allSelectedText: 'All Age'
		});*/
		$('#petSize').multiselect({
			buttonWidth: '100%',
			dropRight: true,
			maxHeight: 150,
			nonSelectedText: 'Size',
			includeSelectAllOption: true,
            selectAllValue: 'select-all-value',
			allSelectedText: 'All Size'
		});
        
        var nonLinearSlider = document.getElementById('petAge');

		noUiSlider.create(nonLinearSlider, {
			connect: true,
			behaviour: 'tap',
			start: [0,30],
			range: {
				'min': [0],
				'1%': [1,1],
				'max': [30]
			},
			format: {
				from: function(value) {
						return parseInt(value);
					},
				to: function(value) {
						return parseInt(value);
					}
			}

		});

		var nodes = [
			document.getElementById('lower-value'), // 0
			document.getElementById('upper-value')  // 1
		];

		// Display the slider value and how far the handle moved
		// from the left edge of the slider.
		nonLinearSlider.noUiSlider.on('update', function ( values, handle, unencoded, isTap, positions ) {
			nodes[handle].innerHTML = values[handle];
		});

		nonLinearSlider.noUiSlider.on('end', function () {
			document.getElementById('petAgeTextHolder').innerHTML = document.getElementById('lower-value').innerHTML+" to "+ document.getElementById('upper-value').innerHTML;
		});

		$.ajax({
            url: "/listInterest",
            type: "GET",
            data: {
				query:"",
            },
            success: function (mes) {
				console.log(mes);
                if(mes.length!=0){
					petData=mes;
					if (mes.length>12){
						for(var i=0; i<12;i++){
							$(".slides").append("\
								<li>\
									<div class='overlay' onclick=\"changeModal("+i+")\" data-toggle='modal' data-target='#petDetailModal'>\
										<a id=\"pet_image\">"+mes[i].peturl+"</a>\
										<div class='flex-caption'>\
											<div style='display:table'>\
												<div style='display:table-row'>\
													<div class='captionName' style='display:table-cell'>"+mes[i].name+"</div>\
												</div>\
												<div style='display:table-row'>\
													<div class='captionDescription' style='display:table-cell'>"+mes[i].age+"</div>\
												</div>\
													<div style='display:table-row'>\
													<div class='captionDescription' style='display:table-cell'>"+mes[i].gender+"</div>\
												</div>\
												<div style='display:table-row'>\
													<div class='captionBreeds' style='display:table-cell'>"+mes[i].breed+"</div>\
												</div>\
											</div>\
										</div>\
									</div>\
								</li>")
						}
					}
					else {
						mes.forEach(function(element,index){
							$(".slides").append("\
								<li>\
									<div class='overlay' onclick=\"changeModal("+index+")\" data-toggle='modal' data-target='#petDetailModal'>\
										<a id=\"pet_image\">"+element.peturl+"</a>\
										<div class='flex-caption'>\
											<div style='display:table'>\
												<div style='display:table-row'>\
													<div class='captionName' style='display:table-cell'>"+element.name+"</div>\
												</div>\
												<div style='display:table-row'>\
													<div class='captionDescription' style='display:table-cell'>"+element.age+"</div>\
												</div>\
													<div style='display:table-row'>\
													<div class='captionDescription' style='display:table-cell'>"+element.gender+"</div>\
												</div>\
												<div style='display:table-row'>\
													<div class='captionBreeds' style='display:table-cell'>"+element.breed+"</div>\
												</div>\
											</div>\
										</div>\
									</div>\
								</li>")
						});
					}
				}
            },
            error: function (err) {
                console.log(err);
            }
        }).done(function() {
				$('.flexslider').flexslider({
					animation: "slide",
					animationLoop: false,
					itemWidth: 200,
					itemMargin: 15,
					start: function(){ $(".flexslider li").css("width", "200"); }
				});
			});
	});


			

	
	function encodeImageFileAsURL() {
	  var base64Image="";
	  var rootImage="";
	  var stringStorage="";
  
	  var filesSelected = document.getElementById("inputFile").files;
	  if (filesSelected.length > 0) {
		var fileToLoad = filesSelected[0];
  
		var fileReader = new FileReader();
  
		fileReader.onload = function(fileLoadedEvent) {
			var srcData = fileLoadedEvent.target.result; // <--- data: base64
			var newImage = document.createElement('img');
			newImage.src = srcData;

			rootImage = newImage.outerHTML;
			base64Image=rootImage.substring(rootImage.indexOf(",")+1,rootImage.length-2);
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "https://vision.googleapis.com/v1/images:annotate?key=AIzaSyC1bOumXTVe-xgDQNInDdk_V2xTPnFoie4");
			xhr.setRequestHeader("Content-Type", "application/json");
			xhr.send(JSON.stringify({"requests":[{"image":{"content":base64Image},"features": [{"type":"LABEL_DETECTION","maxResults":8}]}]}));
			//xhr.send(JSON.stringify({"requests":  [{ "features":  [ {"type": "LABEL_DETECTION"}], "image": {"content": encoded}}]}));
			xhr.onload = function() {
				var resultList=JSON.parse(xhr.response);
				for (var i=0;i<resultList.responses[0].labelAnnotations.length;i++){
					stringStorage+="'"+resultList.responses[0].labelAnnotations[i].description+"',";
				}
				stringStorage=stringStorage.substring(0,stringStorage.length-1);
				adoption_list["breed"]=stringStorage;
				adoption_search_query=" AND breed in ("+stringStorage+")";
				dynamic('/toPetSearch');
			}
		}
		fileReader.readAsDataURL(fileToLoad);
	  }
	}

	function fileUpload(){
		$("#inputFile").click();
	}

	function changeASQ(query){
		adoption_search_query=query;
	}

	function changeList(type){
		adoption_list['type']=type;
	}

	function changeASQByKey(){
		var keyword=$("#auto_complete").val()
		var keyword_low=$("#auto_complete").val().toLowerCase();
		adoption_search_query=" AND (petid||name||type||breed||gender||age||postdate||size||coat) LIKE any (array['%"+keyword+"%','%"+keyword_low+"%'])";
		if(keyword_low=="cat"||keyword_low=="dog"){
			adoption_list["type"]=keyword_low;
		}
		else{
			adoption_list["breed"]=keyword_low;
		}
			
	}

	function changeASQBySelect(){
		var searchQuery="";
		var temp="";
		if ($("#petTypes").val()!=null){
			temp="";
			for (var i=0;i<$("#petTypes").val().length;i++){
				temp+="'"+$("#petTypes").val()[i]+"',"
			}
			temp=temp.substring(0,temp.length-1);
			console.log(temp);

			searchQuery+=" AND type IN("+temp+")";
			adoption_list['type']=temp;
		}
		if ($("#petBreeds").val()!=null){
			temp="";
			for (var i=0;i<$("#petBreeds").val().length;i++){
				temp+="'"+$("#petBreeds").val()[i]+"',"
			}
			temp=temp.substring(0,temp.length-1);

			searchQuery+=" AND breed IN("+temp+")";
			adoption_list['breed']=temp;
		}

		if ($("#petGender").val()!=null){
			temp="";
			for (var i=0;i<$("#petGender").val().length;i++){
				temp+="'"+$("#petGender").val()[i]+"',"
			}
			temp=temp.substring(0,temp.length-1);

			searchQuery+=" AND gender IN("+temp+")";
			adoption_list['gender']=temp;
		}

		if ($("#petSize").val()!=null){
			temp="";
			for (var i=0;i<$("#petSize").val().length;i++){
				temp+="'"+$("#petSize").val()[i]+"',"
			}
			temp=temp.substring(0,temp.length-1);

			searchQuery+=" AND size IN("+temp+")";
		}

		if ($("#petAgeTextHolder").text()!="Age"){
			adopton_query_age=$("#petAgeTextHolder").text();
			adoption_list['age']=adopton_query_age;
		}
		
		adoption_search_query=searchQuery;
		dynamic('/toPetSearch');

	}

</script>

