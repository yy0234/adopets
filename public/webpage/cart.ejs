	<link rel="stylesheet" type="text/css" href="/stylesheets/pages/cart.css" />
	<link rel="stylesheet" type="text/css" href="/stylesheets/fontawesome-all.css"/>

	<div class="container-fluid">
		<div class="container">
			<div class="py-5 text-center">
			  <h2>Checkout</h2>
			</div>

			<div class="row">
			  <div class="col-md-4 order-md-2 mb-4">
					<h4 class="d-flex justify-content-between align-items-center mb-3">
						<span class="text-muted">Your cart</span>
						<span class="badge badge-secondary badge-pill" id="numberOfItem">0</span>
					</h4>
					<ul class="list-group mb-3" id="cart_detail">
						<!--
						<li class="list-group-item d-flex justify-content-between lh-condensed">
						<div>
							<h6 class="my-0">Product name</h6>
							<small class="text-muted">Brief description</small>
						</div>
						<span class="text-muted">$12</span>
						</li>
						<li class="list-group-item d-flex justify-content-between">
						<span>Total (USD)</span>
						<strong>$20</strong>
						</li>
						-->
					</ul>
	  
			  </div>
			  <div class="col-md-8 order-md-1">
				<form class="needs-validation" novalidate>
					<div class="row">
						<h4 class="mb-3">Billing address</h4>
					</div>
				  <div class="row">
						<div class="col-md-6 mb-3">
							<label for="firstName">First name</label>
							<input type="text" class="form-control" id="firstName" placeholder="" value="" required>
							<div class="invalid-feedback">
							Valid first name is required.
							</div>
						</div>
						<div class="col-md-6 mb-3">
							<label for="lastName">Last name</label>
							<input type="text" class="form-control" id="lastName" placeholder="" value="" required>
							<div class="invalid-feedback">
							Valid last name is required.
							</div>
						</div>
				  </div>
					
					<!-- 
					<div class="mb-3">
						<label for="username">Username</label>
						<div class="input-group">
							<div class="input-group-prepend">
							<span class="input-group-text">@</span>
							</div>
							<input type="text" class="form-control" id="username" placeholder="Username" required>
							<div class="invalid-feedback" style="width: 100%;">
							Your username is required.
							</div>
						</div>
					</div>
					
					<div class="mb-3">
						<label for="email">Email <span class="text-muted">(Optional)</span></label>
						<input type="email" class="form-control" id="email" placeholder="you@example.com">
						<div class="invalid-feedback">
							Please enter a valid email address for shipping updates.
						</div>
					</div>
				-->
					
				<div class="row">
					<div class="col-md-12 mb-3">
						<label for="address">Address</label>
						<input type="text" class="form-control" id="address" placeholder="Flat/Floor/Building" required>
						<div class="invalid-feedback">
							Please enter your shipping address.
						</div>
					</div>
				</div>
				
				<div class="row">
					<div class="col-md-12 mb-3">
						<label for="address2">Address 2 <span class="text-muted">(Optional)</span></label>
						<input type="text" class="form-control" id="address2" placeholder="Street">
					</div>
				</div>
	  
				<div class="row">
					<div class="col-md-5 mb-3">
						<label for="region">Region</label>
						<select class="custom-select d-block w-100" id="region" required>
						<option value="" class="nothing">Choose...</option>
						<option class="hk" id="selectionone">Hong Kong Island</option>
						<option class="kl" id="selectiontwo">Kowloon</option>
						<option class="nt" id="selectionthree">New Territories</option>
						</select>
						<div class="invalid-feedback">
						Please select a valid region.
						</div>
					</div>
					<div class="col-md-4 mb-3">
						<label for="district">District</label>
						<select class="custom-select d-block w-100" id="district" required>
						<option value="" class="abc">Choose...</option>
							<option value="cw" class="selectors hk">Central and Western</option>
							<option value="eastern" class="selectors hk">Eastern</option>
							<option value="southern" class="selectors hk">Southern</option>
							<option value="wc" class="selectors hk">Wan Chai</option>
							<option value="ssp" class="selectors kl">Sham Shui Po</option>
							<option value="kc" class="selectors kl">Kowloon City</option>
							<option value="ktong" class="selectors kl">Kwun Tong</option>
							<option value="wts" class="selectors kl">Wong Tai Sin</option>
							<option value="ytm" class="selectors kl">Yau Tsim Mong</option>
							<option value="islands" class="selectors nt">Islands</option>
							<option value="ktsing" class="selectors nt">Kwai Tsing</option>
							<option value="north" class="selectors nt">North</option>
							<option value="sk" class="selectors nt">Sai Kung</option>
							<option value="st" class="selectors nt">Sha Tin</option>
							<option value="tp" class="selectors nt">Tai Po</option>
							<option value="tw" class="selectors nt">Tsuen Wan</option>
							<option value="tm" class="selectors nt">Tuen Mun</option>
							<option value="yl" class="selectors nt">Yuen Long</option>
						</select>
						<div class="invalid-feedback">
						Please provide a valid district.
						</div>
					</div>
				</div>
				
				  <hr class="mb-4">
					
					<div class="row">
						<h4 class="mb-3">Credit Card Information</h4>
						<!--
						<div class="d-block my-3">
						<div class="custom-control custom-radio">
							<input id="credit" name="paymentMethod" type="radio" class="custom-control-input" checked required>
							<label class="custom-control-label" for="credit">Credit card</label>
						</div>
						<div class="custom-control custom-radio">
							<input id="paypal" name="paymentMethod" type="radio" class="custom-control-input" required>
							<label class="custom-control-label" for="paypal">Paypal</label>
						</div>
						</div>
						-->
					</div>
				  <div class="row">
						<div class="col-md-6 mb-3">
							<label for="cc-name">Name on card</label>
							<input type="text" class="form-control" id="cc-name" placeholder="" required>
							<small class="text-muted">Full name as displayed on card</small>
							<div class="invalid-feedback">
							Name on card is required
							</div>
						</div>
					</div>
					<div class="row">
						<div class="col-md-6 mb-3">
							<label for="cc-number">Credit card number</label>
							<input type="text" class="form-control" id="cc-number" placeholder="" required>
							<div class="invalid-feedback">
							Credit card number is required
							</div>
						</div>
				  </div>
				  <div class="row">
						<div class="col-md-3 mb-3">
							<label for="cc-expiration">Expiration Date</label>
							<input type="text" class="form-control" id="cc-expiration" placeholder="" required>
							<div class="invalid-feedback">
							Expiration date required
							</div>
						</div>
						<div class="col-md-3 mb-3">
							<label for="cc-expiration">CVV</label>
							<input type="text" class="form-control" id="cc-cvv" placeholder="" required>
							<div class="invalid-feedback">
							Security code required
							</div>
						</div>
				  </div>
				  <hr class="mb-4">
				  <button class="btn btn-primary btn-lg btn-block" type="submit">Checkout</button>
				</form>
			  </div>
			</div>
	</div>
</div>
<script>

	(function() {
				'use strict';
				autoFillUserName();
				list_delete('list');
        window.addEventListener('load', function() {
          // Fetch all the forms we want to apply custom Bootstrap validation styles to
          var forms = document.getElementsByClassName('needs-validation');

          // Loop over them and prevent submission
          var validation = Array.prototype.filter.call(forms, function(form) {
            form.addEventListener('submit', function(event) {
              if (form.checkValidity() === false) {
                event.preventDefault();
                event.stopPropagation();
							}
							else
							{
								addPurchase();
								alert('Transaction successful. Thank you for your order!');
							}
							form.classList.add("was-validated");
            }, false);
          });
				}, false);
				
				var allOptions = $('#district option')
				$('#region').change(function () {
						$('#district option').remove()
						var classN = $('#region option:selected').prop('class');
						var opts = allOptions.filter('.' + classN);
						$.each(opts, function (i, j) {
								$(j).appendTo('#district');
						});
				});

      })();


function list_delete(task,name){
		$.ajax({
								url: "/getlogined",
								type: "GET",
								success: function (info) {
								  if (task == 'list')
										listItem(info.loginUser);
									else if (task == 'delete')
										deleteItem(info.loginUser,name);
								},
								error: function (err) {
									console.log(err);
								}
						});
}

	function deleteItem(userid,name){
		$.ajax({
			url: "/deleteCart",
			type: "POST",
			dataType: 'json',
			contentType: "application/json",
			data: JSON.stringify({
						userid:userid,
            name:name
			}),
			complete: function complete() {
			},
			error: function error(err) {
                console.log(err);
			},
			success: function success(mes) {
                console.log(mes);
			}
		})
		listItem();
	};



	function listItem(userid){
				$.ajax({
					url: "/listCart",
					type: "GET",
					data: {
						query:"where userid = '"+userid+"'",
					},
					success: function (item) {
						$("#cart_detail").html("");
						if (item.length==0){
							$("#cart_detail").html("<div style=\"text-align: center;margin: 0 auto;\">No record found</div>");	
							$('#numberOfItem').text('0');
						}
						else 
						{
							var total = 0;
							var counter = 0;
							for (i=0; i<item.length; i++)
							{
											total = parseFloat(total)+parseFloat(item[i].price.substring(1,item[i].price.length));
											counter++;
											$("#cart_detail").append("\
											<li class=\"list-group-item d-flex justify-content-between lh-condensed\">\
												<div class=\"buttons cart_data\" onclick=\"list_delete('delete','"+item[i].name+"')\">\
															<span class=\"delete-btn\"></span>\
															<i class=\"fas fa-trash-alt\"></i>\
												</div>\
												<h6 class=\"my-0 mr-auto cart_data\">" + item[i].name + "</h6>\
												<span class=\"text-muted cart_data\" id=\"price-"+i+"\" >" + item[i].price + "</span>\
												<input class=\"quantity\" type=\"number\" id=\"quantity-"+i+"\" onchange=\"qtyChange('"+item[i].price+"',"+i+")\" style=\"width: 2em; height: 2em;\" min=\"1\" max=\"99\" step=\"1\" value=\"1\">\
											</li>")
							};
							$("#cart_detail").append("\
									<li class=\"list-group-item d-flex justify-content-between\">\
										<span>Total (HKD)</span>\
										<strong id=\"total\">$"+ total.toFixed(2) +"</strong>\
									</li>");
							$('#numberOfItem').text(counter);
							}
					},
					error: function (err) {
						console.log(err);
					}
				});
		};

		function qtyChange(price,order){
			document.getElementById('price-'+order).innerHTML = '$' + (document.getElementById('quantity-'+order).value * price.substring(1,price.length)).toFixed(2);
			/*
			var content = document.getElementById('total').innerHTML;
			content = content.substring(1,content.length);
			total = parseFloat(content) + parseFloat(price.substring(1,price.length));
			document.getElementById('total').innerHTML = '$' + total.toFixed(2);
			*/
			var total = 0;
			for (var i = 0; i < parseInt($("#cart_detail").children().length) - 1; i++){
				total += parseFloat(document.getElementById('price-'+ i).innerHTML.substring(1, document.getElementById('price-'+ i).innerHTML.length));
			}
			document.getElementById("total").innerHTML = "$" + total.toFixed(2);
		}

		function autoFillUserName(){
			$.ajax({
					url: "/getlogined",
					type: "GET",
					success: function (info) {
						document.getElementById("username").value = info.loginUser;
					},
					error: function (err) {
						console.log(err);
					}
				});
		}

function addPurchase(){
	$.ajax({
		url: "/getlogined",
		type: "GET",
		success: function (info) {
			for (var i = 0; i < parseInt($("#cart_detail").children().length) - 1; i++){
				var quantity = document.getElementById('quantity-'+i).value;
				var price = parseFloat(document.getElementById('price-'+ i).innerHTML.substring(1, document.getElementById('price-'+ i).innerHTML.length));
				$.ajax({
							url: "/addPurchaseSupply",
							type: "POST",
							dataType: 'json',
							contentType: "application/json",
							data: JSON.stringify({
								buyid:info.loginUser,
								name:name,
								price:price,
								quantity:quantity,
								buyTime: new Date(),
							}),
							complete: function complete() {
							},
							error: function error(err) {
								console.log(err);
							},
							success: function success(mes) {
								console.log(mes);
							}
						})
				}
		},
		error: function (err) {
			console.log(err);
		}
	});
}

</script>
